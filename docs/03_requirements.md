# 3. 要件定義（Requirements）

本章では、本システムの機能要件・非機能要件・例外処理方針を整理し、  
**実装判断の基準となる仕様**を明確化する。

第2章「利用シーン（Use Cases）」で整理した操作フローを、  
**実装上の確定仕様として固定すること**を目的とする。

---

## 3.1 機能要件（Functional Requirements）

本システムは以下の 2 大機能で構成される。

---

### ① 体調管理モジュール（Django）

#### ● 一般社員向け機能
- ログイン（Django 標準認証方式）
- 当日の体調入力  
  （肉体的／精神的それぞれ 1〜5 のアイコン選択）
- 入力確認画面で内容を再確認
- 確定後に登録処理を実行
- 体調入力は **1 日 1 回のみ** とし、入力後の上書きは不可  
- 入力完了画面に遷移後、**60 秒無操作で自動ログアウト**  
- 体調入力とは別に、当日出社しない場合は **「休み」を明示的に登録する操作**を提供  
  ※ 未入力＝休み、とは扱わない  
- 必要に応じて、ご意見箱ページへ遷移できる（任意リンク）

#### ● 管理者向け機能（レベル1／レベル2）
- ログイン後、統計ダッシュボードを閲覧
- pandas による簡易分析（平均・中央値・傾向）
- 休みとして登録された日は集計対象外
- 管理者レベル1：氏名を含む統計が閲覧可能
- 管理者レベル2：匿名化された統計のみ閲覧可能
- 管理者は **例外的に体調データの修正が可能**  
  修正時は **元データの履歴を保持**する  
- 管理者画面は **1〜60 分の範囲で設定可能な自動ログアウト**を備える  

#### ● 管理機能
- 社員ID・氏名・性別・年齢を管理（登録・更新）
- 年代情報は DB には保持せず、分析処理で算出する  
- 集計対象外フラグを管理画面で設定可能

---

### ② ご意見箱モジュール（PHP）

#### ● 位置づけ
- ご意見箱は **サブ機能**とする  

#### ● 投稿モード選択
- 匿名
- 準匿名
- 署名

#### ● 投稿内容入力
- 内容テキストを入力
- タグ（カテゴリ）を選択して分類
- バリデーション（空欄防止、最大文字数チェック）

#### ● 投稿確認・保存
- 入力内容と投稿モードを確認
- 確定後、**CSV ファイルにのみ保存**
- Django 側 DB には保存しない  

#### ● 管理者による閲覧
- 管理者レベル1：匿名投稿には関与しない
- 管理者レベル2：投稿内容およびタグのみ確認可能  

#### ● CSV 出力仕様（正式）
timestamp, employee_id, mode, content, tag

---

## 3.2 非機能要件（Non-Functional Requirements）

### ● 性能要件
- 体調入力の登録は 1 秒以内
- ダッシュボード表示は 3 秒以内
- CSV 読み込み分析は 2 秒以内

### ● 信頼性
- **週次バックアップを必須要件**とする  
- 日次バックアップは将来拡張とする

### ● セキュリティ要件
- Django 側は標準の CSRF 対策を使用
- PHP ご意見箱では **セッションフラグによる直接 POST 防止**  
  POST 限定・直接アクセス防止で代替する  
- XSS・SQL Injection はエスケープおよび ORM で対策
- 権限レベルに応じた閲覧制御を行う
- 自動ログアウトにより不正利用を防止  
  一般社員：60 秒／管理者：1〜60 分（設定可）

### ● 保守性
- Django と PHP モジュールは完全分離
- データ連携は CSV のみ
- GitHub によるバージョン管理を行う

### ● 拡張性
- 休み種別の細分化は将来拡張とする
- 日次バックアップは将来拡張とする
- AI 解析追加を想定し、前処理構造を維持  

---

## 3.3 例外処理（Exception Handling）

### ● 休みの場合
- 体調入力は行わず、休みフラグのみ登録する。
- 未入力は休み扱いとしない。  

### ● 入力中断
- 確定前に画面を閉じた場合、データは保存されない。

### ● 誤入力防止
- 体調入力時は、アイコン選択後に確認画面を表示する。
- 確認操作を挟むことで、誤操作による登録を防止する。

### ● 画面放置
- 一般社員は、無操作状態が **60 秒** 続いた場合に自動ログアウトする。
- 管理者は、無操作状態が **1〜60 分（設定可）** を超えた場合に自動ログアウトする。  

---

## 3.4 データ対象外（除外設定）

### ● 集計対象外フラグ
- 特定の社員（例：産休中・長期出張・役員など）を  
  「集計対象外」として登録できる。
- DB 上で `is_target=True/False` のフラグとして管理する。
- 集計処理では、このフラグが False のレコードは除外される。

---

## 3.5 データ分析（Analysis Requirements）

- pandas を用いて体調データおよびご意見箱データを分析する。
- DB 上では **年齢（age）を正規データとして保持**する。
- 年代区分（age_range）は、分析処理内で派生的に生成する。
- CSV データは **読み取り専用のデータ源**として扱う。
- 最低限の分析（平均・中央値・傾向）は現行仕様に含める。
- AI・高度分析の導入は将来拡張とし、現行要件には含めない。
