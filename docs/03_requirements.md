# 3. 要件定義（Requirements）

本章では、本システムの機能要件・非機能要件・例外処理方針を整理し、  
開発の基盤となる仕様を明確化する。

---

## 3.1 機能要件（Functional Requirements）

本システムは以下の 2 大機能で構成される。

### ① 体調管理モジュール（Django）

#### ● 一般社員向け機能
- ログイン（Django 標準認証方式）
- 当日の体調入力（肉体／精神の 1〜5 アイコン選択）
- 入力確認画面で内容を再チェック
- 確定後に登録処理が実行される
- 入力完了画面に自動遷移、10 秒無操作で自動ログアウト
- 必要に応じて、ご意見箱ページへ遷移できる（任意リンク）

#### ● 管理者向け機能（レベル1／レベル2）
- ログインし統計ダッシュボードを閲覧
- pandas による簡易分析（平均・中央値・傾向）
- 欠勤（NULL）は集計対象外
- レベル1は氏名を含む統計が閲覧可能  
- レベル2は匿名化された統計のみ閲覧可能  
- ご意見箱の投稿内容は、権限に応じて CSV から閲覧可（匿名除く）
- 指定時間（1〜60 分）で自動ログアウト（管理者のみ）

#### ● 管理機能
- 社員ID・氏名・性別・年齢・部署を管理（登録・更新）
- 集計対象外フラグ（除外対象）を管理画面で設定可能  
  ※最初の運用時ヒアリングで設定する想定。

---

### ② ご意見箱モジュール（PHP）

#### ● 投稿モード選択
- 匿名  
- 準匿名（性別・年代のみ付与）  
- 署名（性別・年齢・氏名をそのまま付与）

#### ● 投稿内容入力
- 内容テキストを入力
- タグ（カテゴリ）を選択して分類（業務改善／環境／安全性 など）
- バリデーション（空欄防止、最大文字数チェック）

#### ● 投稿確認画面
- 入力内容を表示し、内容と公開モードを再確認
- 「投稿」ボタンで CSV に保存

#### ● 投稿完了画面
- 完了メッセージを表示
- 5 秒後に自動でトップに戻る（任意）

#### ● CSV 出力仕様
```csv
timestamp, mode, gender, age, department, content, tag
2025-01-01 09:10, 匿名, -, -, -, "〜〜〜〜", "環境改善"
2025-01-01 09:12, 準匿名, 男性, 30代, -, "〜〜〜〜", "業務改善"
2025-01-01 09:20, 署名, 女性, 29, 総務, "〜〜〜〜", "安全性"
```

---

## 3.2 非機能要件（Non-Functional Requirements）

### ● 性能要件
- 体調入力の登録は 1 秒以内に完了する
- ダッシュボード表示は 3 秒以内に読み込まれる
- CSV 読み込み分析は 2 秒以内

### ● 信頼性
- 週次バックアップを必須  
  （体調データ・ご意見 CSV すべてをバックアップ）
- 日次バックアップは拡張機能として設計に残す

### ● セキュリティ要件
- Django の CSRF 対策は標準機能を使用
- XSS・SQL Injection は ORM とエスケープで対応
- 管理者画面は権限レベルにより閲覧内容を制御
- 自動ログアウトで不正利用を防止（1〜60分で設定可能）

### ● 保守性
- Django と PHP のモジュールは完全に分離して管理
- データ連携は CSV に限定する（DB直結は行わない）
- コードは GitHub でバージョン管理
- 章ごとに分割された設計書で管理し差分追跡しやすくする

### ● 拡張性
- AI 解析追加を想定し、pandas による前処理を標準化  
- 勤怠データ・出退勤ログの取り込みを別モジュールとして拡張可能  
- 投稿データにタグ付けしたことで分類学習の基礎データとして利用可能  

---

## 3.3 例外処理（Exception Handling）

### ● 欠勤（来ない日の処理）
- 入力なし → レコードは NULL  
- NULL は自動的に集計対象外  
- 未入力エラーは発生しない

### ● 入力中断
- 確定前に画面が閉じた場合はデータは保存されない  
- 再ログインして再度入力すればよい

### ● 誤入力防止
- アイコンタップ後に確認画面を挟むため誤操作を防止
- ご意見投稿も「投稿モード確認 → 内容確認」の二段階方式

### ● 画面放置
- 一般社員：10 秒で自動ログアウト  
- 管理者：設定した時間（1〜60 分）で自動ログアウト

---

## 3.4 データ対象外（除外設定）

### ● 集計対象外フラグ
- 特定の社員（例：産休中・長期出張・役員など）を  
  「集計対象外」として登録できる  
- DB 上で `is_target=True/False` のフラグ管理
- 集計ではこのフラグが False のレコードは除外される

---

## 3.5 データ分析（Analysis Requirements）

- pandas を用いて体調データ・意見データを定期分析
- CSV と DB データを統合しやすい前処理構造を維持
- 最低限の分析（平均・中央値・傾向）は標準で提供
- AI・深層学習モデル追加に備えてデータ構造を揃える

